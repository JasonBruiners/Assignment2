---
title: "Analysis and Visualisation"
output: html_notebook
---

```{r}
# Libraries
library(usethis)
library(ggplot2)
library(readr)
library(maps)
library(tidytext)
library(dplyr)


```

# Load extracted data 
```{r}
#News24_tweets <- read_rds("Data/News24_tweets.rds")
#TimesLIVE_tweets <- read_rds("Data/TimesLIVE_tweets.rds")
#eNCA_tweets <- read_rds("Data/eNCA_tweets.rds")
#IOL_tweets <- read_rds("Data/IOL_tweets.rds")
#SABCNews_tweets <- read_rds("Data/SABCNews_tweets.rds")
#ewnupdates_tweets <- read_rds("Data/ewnupdates_tweets")

#Load Topic Modelling Data
#LDA
News24_top_terms_LDA <- read_rds("Data/Final_Data/News24_top_terms_LDA.rds")
TimesLIVE_top_terms_LDA <- read_rds("Data/Final_Data/timesLIVE_top_terms_LDA.rds")
ewn_top_terms_LDA <- read_rds("Data/Final_Data/Ewnupdate_top_terms_LDA.rds")
IOL_top_terms_LDA <- read_rds("Data/Final_Data/IOL_top_terms_LDA.rds")
eNCA_top_terms_LDA <- read_rds("Data/Final_Data/eNCA_top_terms_LDA.rds")
SABC_top_terms_LDA <- read_rds("Data/Final_Data/SABC_top_terms_LDA.rds")
#global_top_terms_LDA <- read_rds("Data/Final_Data/global_top_terms_LDA.rds")

#STM
News24_top_terms <- read_rds("Data/Final_Data/News24_top_terms.rds")
TimesLIVE_top_terms <- read_rds("Data/Final_Data/timesLIVE_top_terms.rds")
ewnupdate_top_terms <- read_rds("Data/Final_Data/Ewnupdate_top_terms.rds")
IOL_top_terms <- read_rds("Data/Final_Data/IOL_top_terms.rds")
eNCA_top_terms <- read_rds("Data/Final_Data/eNCA_top_terms.rds")
SABC_top_terms <- read_rds("Data/Final_Data/SABC_top_terms.rds")
global_top_terms <- read_rds("Data/Final_Data/global_top_terms.rds")
```


# Generating visuals
## Global Theme
```{r}
t <- theme(
  axis.text.x=element_text(colour = "black",face = "bold"),
  axis.text.y=element_text(colour = "black",face = "bold"),
  axis.title.x=element_blank(),
  axis.title.y=element_blank(),
  axis.ticks=element_blank(),
  panel.border=element_blank(),
  panel.grid.major.y =element_blank(),
  panel.grid.major.x =element_line(colour = "black"), 
  panel.grid.minor=element_blank(),
  plot.background=element_rect(fill = "grey"),
  plot.caption = element_text(colour ="black",face = "bold" ,hjust = 1),
  plot.title = element_text(size = 20, colour ="black",face = "bold" ,hjust = 0.5),
)

```


```{r}

# plot of the frequency of tweets
ts_plot(NEWS24_tweets, "3 hours") +
  ggplot2::theme_minimal() +
  ggplot2::theme(plot.title = ggplot2::element_text(face = "bold")) +
  ggplot2::labs(
    x = NULL, y = NULL,
    title = "Frequency of Tweets",
    subtitle = "Twitter status (tweet) counts aggregated using three-hour intervals",
    caption = "\nSource: Data collected from Twitter's REST API via rtweet"
  )

# plot tweet locations
par(mar = c(0, 0, 0, 0))
maps::map("state", lwd = .25)
with(geocoded, points(lng, lat, pch = 20, cex = .75, col = rgb(0, .3, .7, .75)))

```


## Sentiment visuals
```{r}
# sentiment score
affin_tweets %>% group_by(sentiment) %>% top_n(10) %>% ungroup() %>% mutate(word = reorder(word, n)) %>% ggplot(aes(x=word,y=n, fill = sentiment))+
  geom_col()+facet_wrap(~sentiment, scales = "free_y")+
  labs(title = "Sentiments", x = NULL, y = "Contribution")+
  theme_minimal()

```


## Topic Modelling visuals
###  Latent Dirichlet Allocation 
```{r}
News24_top_terms_LDA %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  coord_flip() +
  labs(title = "LDA Topic Modeling for News24 ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(
  strip.text = element_text(face = "bold"),
  axis.text.y=element_text(colour = "black",face = "bold", size = 6),
)
```

```{r}
TimesLIVE_top_terms_LDA %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  coord_flip() +
  labs(title = "LDA Topic Modeling for TimesLIVE ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```
```{r}
ewn_top_terms_LDA %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  coord_flip() +
  labs(title = "LDA Topic Modeling for EWN ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```


```{r}
IOL_top_terms_LDA %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  coord_flip() +
  labs(title = "LDA Topic Modeling for IOL ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```

```{r}
eNCA_top_terms_LDA %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  coord_flip() +
  labs(title = "LDA Topic Modeling for eNCA ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```

```{r}
SABC_top_terms_LDA %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ topic, scales = "free") +
  coord_flip() +
  labs(title = "LDA Topic Modeling for SABCNews ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```

### Structural Topic Modelling
```{r}
#Global STM Plot
global_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) + 
  scale_y_continuous(breaks = c(0.00, 0.02, 0.04, 0.060, 0.080),labels = c("0", ".02", ".04", ".06", ".08")) +
  expand_limits(y=c(0,0.08)) + 
  facet_wrap(~ topic, scales = "free") + 
  coord_flip() +
  labs(title = "Structural Topic Modeling for News24 ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```

```{r}
#News24 STM Plot
News24_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) + 
  scale_y_continuous(breaks = c(0.00, 0.02, 0.04, 0.060, 0.080),labels = c("0", ".02", ".04", ".06", ".08")) +
  expand_limits(y=c(0,0.08)) + 
  facet_wrap(~ topic, scales = "free") + 
  coord_flip() +
  labs(title = "Structural Topic Modeling for News24 ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```

```{r}
#TimesLIVE STM Plot
TimesLIVE_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) + 
  scale_y_continuous(breaks = c(0.00, 0.02, 0.04, 0.060, 0.080),labels = c("0", ".02", ".04", ".06", ".08")) +
  expand_limits(y=c(0,0.08)) + 
  facet_wrap(~ topic, scales = "free") + 
  coord_flip() +
  labs(title = "Structural Topic Modeling for TimesLIVE ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```


```{r}
#ewn STM Plot
ewnupdate_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) + 
  scale_y_continuous(breaks = c(0.00, 0.02, 0.04, 0.060, 0.080),labels = c("0", ".02", ".04", ".06", ".08")) +
  expand_limits(y=c(0,0.08)) + 
  facet_wrap(~ topic, scales = "free") + 
  coord_flip() +
  labs(title = "Structural Topic Modeling for EWN ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```


```{r}
#IOL STM Plot
IOL_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) + 
  scale_y_continuous(breaks = c(0.00, 0.02, 0.04, 0.060, 0.080),labels = c("0", ".02", ".04", ".06", ".08")) +
  expand_limits(y=c(0,0.08)) + 
  facet_wrap(~ topic, scales = "free") + 
  coord_flip() +
  labs(title = "Structural Topic Modeling for IOL ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```


```{r}
#eNCA STM Plot
eNCA_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) + 
  scale_y_continuous(breaks = c(0.00, 0.02, 0.04, 0.060, 0.080),labels = c("0", ".02", ".04", ".06", ".08")) +
  expand_limits(y=c(0,0.08)) + 
  facet_wrap(~ topic, scales = "free") + 
  coord_flip() +
  labs(title = "Structural Topic Modeling for eNCA ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```


```{r}
#SABC STM Plot
SABC_top_terms %>%
  mutate(term = reorder(term, beta)) %>%
  ggplot(aes(term, beta, fill = factor(topic))) +
  geom_col(show.legend = FALSE) + 
  scale_y_continuous(breaks = c(0.00, 0.02, 0.04, 0.060, 0.080),labels = c("0", ".02", ".04", ".06", ".08")) +
  expand_limits(y=c(0,0.08)) + 
  facet_wrap(~ topic, scales = "free") + 
  coord_flip() +
  labs(title = "Structural Topic Modeling for SABC ", caption = "\nSource: Data collected from Twitter's REST API via rtweet"
) + t %+replace% theme(strip.text = element_text(face = "bold"))
```


# Additional Analysis
```{r}
#frequency of tweets
# import Frequency_tweets
ggplot(Frequency_tweets, aes(x = date, y = News24)) + Other_theme + geom_line(color = "grey", size = 0.9) + geom_line(aes(x = date, y = timesLIVE), color = "blue", size = 0.9) + geom_line(aes(x = date, y = Ewnupdate), color = "red", size = 0.9) + geom_line(aes(x = date, y = IOL), color = "brown", size = 0.9) + geom_line(aes(x = date, y = eNCA), color = "green", size = 0.9) + geom_line(aes(x = date, y = SABC), color = "yellow", size = 0.9) + scale_x_date(breaks = "1 day",date_labels = "%d") + scale_y_continuous(breaks = seq(0, 160, by = 20)) + labs(x = NULL, y = NULL, title = "Frequency of Tweets", subtitle = "Three week period in June", caption = "\nSource: Data collected from Twitter's REST API via rtweet")


#retweet Count
#import retweet_tweets
ggplot(retweet_tweets, aes(x = date, y = News24)) + Other_theme + geom_line(color = "grey", size = 0.9) + geom_line(aes(x = date, y = timesLIVE), color = "blue", size = 0.9) + geom_line(aes(x = date, y = Ewnupdate), color = "red", size = 0.9) + geom_line(aes(x = date, y = IOL), color = "brown", size = 0.9) + geom_line(aes(x = date, y = eNCA), color = "green", size = 0.9) + geom_line(aes(x = date, y = SABC), color = "yellow", size = 0.9) + scale_x_date(breaks = "1 day",date_labels = "%d")+ scale_y_continuous(trans = "log2", breaks = c(250,500,750,1000,2000,4000,6000,8000)) + labs(x = NULL, y = NULL, title = "Retweet count", subtitle = "Three week period in June", caption = "\nSource: Data collected from Twitter's REST API via rtweet")


#Like Count
# import Likes_tweets
ggplot(Likes_tweets, aes(x = date, y = News24)) + Other_theme + geom_line(color = "grey", size = 0.9) + geom_line(aes(x = date, y = timesLIVE), color = "blue", size = 0.9) + geom_line(aes(x = date, y = Ewnupdate), color = "red", size = 0.9) + geom_line(aes(x = date, y = IOL), color = "brown", size = 0.9) + geom_line(aes(x = date, y = eNCA), color = "green", size = 0.9) + geom_line(aes(x = date, y = SABC), color = "yellow", size = 0.9) + scale_x_date(breaks = "1 day",date_labels = "%d") + scale_y_continuous(breaks = seq(0, 20000, by = 1500)) + labs(x = NULL, y = NULL, title = "Like counter", subtitle = "Three week period in June", caption = "\nSource: Data collected from Twitter's REST API via rtweet")


#covid vs non covid tweets
#import following variables: data, Gen_tweets
ggplot(data, aes(x="", y=tweet_count, fill = tweet_type)) + geom_bar(stat = "identity", width = 1)+ coord_polar(theta="y", start = 0) + geom_text(aes(label = paste0(round(tweet_count/Gen_tweets*100), "%")), position = position_stack(vjust=0.5)) + theme_void() %+replace% theme(plot.caption = element_text(colour ="black",hjust = +1),) + labs(x = NULL, y = NULL, fill = NULL, title = "Comparison of Covid Coverage by News Media", caption = "\nSource: Data collected from Twitter's REST API via rtweet")


```

