---
title: "Data Transformation"
output: html_notebook
---

```{r}
#install_github("mkearney/rtweet")

#Packages
library(usethis)
library(devtools)
library(dplyr)
library(rtweet)
library(readr)
library(topicmodels)
library(tidyverse)
library(maps)
library(tidytext)
library(textdata)
library(tm)
library(stm)
```

## Load extracted data 
```{r}
News24_tweets <- read_rds("Data/Raw_Timeline_Data/News24_tweets.rds")
TimesLIVE_tweets <- read_rds("Data/Raw_Timeline_Data/TimesLIVE_tweets.rds")
eNCA_tweets <- read_rds("Data/Raw_Timeline_Data/eNCA_tweets.rds")
IOL_tweets <- read_rds("Data/Raw_Timeline_Data/IOL_tweets.rds")
SABCNews_tweets <- read_rds("Data/Raw_Timeline_Data/SABCNews_tweets.rds")
ewnupdates_tweets <- read_rds("Data/Raw_Timeline_Data/ewnupdates_tweets.rds")
```

```{r}
tweets_za_13 <- read_rds("Data/Raw_Filtered_Data/tweets_za_13.rds")
tweets_za_14 <- read_rds("Data/Raw_Filtered_Data/tweets_za_14.rds")
tweets_za_15 <- read_rds("Data/Raw_Filtered_Data/tweets_za_15.rds")
tweets_za_16 <- read_rds("Data/Raw_Filtered_Data/tweets_za_16.rds")
tweets_za_17 <- read_rds("Data/Raw_Filtered_Data/tweets_za_17.rds")
tweets_za_18 <- read_rds("Data/Raw_Filtered_Data/tweets_za_18.rds")
tweets_za_19 <- read_rds("Data/Raw_Filtered_Data/tweets_za_19.rds")
tweets_za_20 <- read_rds("Data/Raw_Filtered_Data/tweets_za_20.rds")
tweets_za_21 <- read_rds("Data/Raw_Filtered_Data/tweets_za_21.rds")
tweets_za_22 <- read_rds("Data/Raw_Filtered_Data/tweets_za_22.rds")

tweets_bloem_13 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_13.rds")
tweets_bloem_14 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_14.rds")
tweets_bloem_15 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_15.rds")
tweets_bloem_16 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_16.rds")
tweets_bloem_17 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_17.rds")
tweets_bloem_18 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_18.rds")
tweets_bloem_19 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_19.rds")
tweets_bloem_20 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_20.rds")
tweets_bloem_21 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_21.rds")
tweets_bloem_22 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_22.rds")

tweets_cpt_13 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_13.rds")
tweets_cpt_14 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_14.rds")
tweets_cpt_15 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_15.rds")
tweets_cpt_16 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_16.rds")
tweets_cpt_17 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_17.rds")
tweets_cpt_18 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_18.rds")
tweets_cpt_19 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_19.rds")
tweets_cpt_20 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_20.rds")
tweets_cpt_21 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_21.rds")
tweets_cpt_22 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_22.rds")

tweets_durb_13 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_13.rds")
tweets_durb_14 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_14.rds")
tweets_durb_15 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_15.rds")
tweets_durb_16 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_16.rds")
tweets_durb_17 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_17.rds")
tweets_durb_18 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_18.rds")
tweets_durb_19 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_19.rds")
tweets_durb_20 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_20.rds")
tweets_durb_21 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_21.rds")
tweets_durb_22 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_22.rds")

tweets_jhb_13 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_13.rds")
tweets_jhb_14 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_14.rds")
tweets_jhb_15 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_15.rds")
tweets_jhb_16 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_16.rds")
tweets_jhb_17 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_17.rds")
tweets_jhb_18 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_18.rds")
tweets_jhb_19 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_19.rds")
tweets_jhb_20 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_20.rds")
tweets_jhb_21 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_21.rds")
tweets_jhb_22 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_22.rds")

tweets_kim_13 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_13.rds")
tweets_kim_14 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_14.rds")
tweets_kim_15 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_15.rds")
tweets_kim_16 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_16.rds")
tweets_kim_17 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_17.rds")
tweets_kim_18 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_18.rds")
tweets_kim_19 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_19.rds")
tweets_kim_20 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_20.rds")
tweets_kim_21 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_21.rds")
tweets_kim_22 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_22.rds")

tweets_klerk_13 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_13.rds")
tweets_klerk_14 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_14.rds")
tweets_klerk_15 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_15.rds")
tweets_klerk_16 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_16.rds")
tweets_klerk_17 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_17.rds")
tweets_klerk_18 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_18.rds")
tweets_klerk_19 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_19.rds")
tweets_klerk_20 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_20.rds")
tweets_klerk_21 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_21.rds")
tweets_klerk_22 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_22.rds")

tweets_mbomb_13 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_13.rds")
tweets_mbomb_14 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_14.rds")
tweets_mbomb_15 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_15.rds")
tweets_mbomb_16 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_16.rds")
tweets_mbomb_17 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_17.rds")
tweets_mbomb_18 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_18.rds")
tweets_mbomb_19 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_19.rds")
tweets_mbomb_20 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_20.rds")
tweets_mbomb_21 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_21.rds")
tweets_mbomb_22 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_22.rds")

tweets_polo_13 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_13.rds")
tweets_polo_14 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_14.rds")
tweets_polo_15 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_15.rds")
tweets_polo_16 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_16.rds")
tweets_polo_17 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_17.rds")
tweets_polo_18 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_18.rds")
tweets_polo_19 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_19.rds")
tweets_polo_20 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_20.rds")
tweets_polo_21 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_21.rds")
tweets_polo_22 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_22.rds")

tweets_pe_13 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_13.rds")
tweets_pe_14 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_14.rds")
tweets_pe_15 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_15.rds")
tweets_pe_16 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_16.rds")
tweets_pe_17 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_17.rds")
tweets_pe_18 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_18.rds")
tweets_pe_19 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_19.rds")
tweets_pe_20 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_20.rds")
tweets_pe_21 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_21.rds")
tweets_pe_22 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_22.rds")
```

# Bind Dataframes
```{r}
tweets_za <-rbind(tweets_za_22,tweets_za_21,tweets_za_20,tweets_za_19,tweets_za_18,tweets_za_17,tweets_za_16,tweets_za_15,tweets_za_14,tweets_za_13)
tweets_bloem <-rbind(tweets_bloem_22,tweets_bloem_21,tweets_bloem_20,tweets_bloem_19,tweets_bloem_18,tweets_bloem_17,tweets_bloem_16,tweets_bloem_15,tweets_bloem_14,tweets_bloem_13)
tweets_cpt <-rbind(tweets_cpt_22,tweets_cpt_21,tweets_cpt_20,tweets_cpt_19,tweets_cpt_18,tweets_cpt_17,tweets_cpt_16,tweets_cpt_15,tweets_cpt_14,tweets_cpt_13)
tweets_durb <-rbind(tweets_durb_22,tweets_durb_21,tweets_durb_20,tweets_durb_19,tweets_durb_18,tweets_durb_17,tweets_durb_16,tweets_durb_15,tweets_durb_14,tweets_durb_13)
tweets_jhb <-rbind(tweets_jhb_22,tweets_jhb_21,tweets_jhb_20,tweets_jhb_19,tweets_jhb_18,tweets_jhb_17,tweets_jhb_16,tweets_jhb_15,tweets_jhb_14,tweets_jhb_13)
tweets_kim <-rbind(tweets_kim_22,tweets_kim_21,tweets_kim_20,tweets_kim_19,tweets_kim_18,tweets_kim_17,tweets_kim_16,tweets_kim_15,tweets_kim_14,tweets_kim_13)
tweets_klerk <-rbind(tweets_klerk_22,tweets_klerk_21,tweets_klerk_20,tweets_klerk_19,tweets_klerk_18,tweets_klerk_17,tweets_klerk_16,tweets_klerk_15,tweets_klerk_14,tweets_klerk_13)
tweets_mbomb <-rbind(tweets_mbomb_22,tweets_mbomb_21,tweets_mbomb_20,tweets_mbomb_19,tweets_mbomb_18,tweets_mbomb_17,tweets_mbomb_16,tweets_mbomb_15,tweets_mbomb_14,tweets_mbomb_13)
tweets_polo <-rbind(tweets_polo_22,tweets_polo_21,tweets_polo_20,tweets_polo_19,tweets_polo_18,tweets_polo_17,tweets_polo_16,tweets_polo_15,tweets_polo_14,tweets_polo_13)
tweets_pe <-rbind(tweets_pe_22,tweets_pe_21,tweets_pe_20,tweets_pe_19,tweets_pe_18,tweets_pe_17,tweets_pe_16,tweets_pe_15,tweets_pe_14,tweets_pe_13)

```

```{r}
#write_rds(tweets_za, "Data/Final_Data/tweets_za.rds")
#write_rds(tweets_bloem, "Data/Final_Data/tweets_bloem.rds")
#write_rds(tweets_cpt, "Data/Final_Data/tweets_cpt.rds")
#write_rds(tweets_durb, "Data/Final_Data/tweets_durb.rds")
#write_rds(tweets_jhb, "Data/Final_Data/tweets_jhb.rds")
#write_rds(tweets_kim, "Data/Final_Data/tweets_kim.rds")
#write_rds(tweets_klerk, "Data/Final_Data/tweets_klerk.rds")
#write_rds(tweets_mbomb, "Data/Final_Data/tweets_mbomb.rds")
#write_rds(tweets_polo, "Data/Final_Data/tweets_polo.rds")
#write_rds(tweets_pe, "Data/Final_Data/tweets_pe.rds")

tweets_za <- read_rds("Data/Final_Data/tweets_za.rds")
tweets_bloem <- read_rds("Data/Final_Data/tweets_bloem.rds")
tweets_cpt <- read_rds("Data/Final_Data/tweets_cpt.rds")
tweets_durb <- read_rds("Data/Final_Data/tweets_durb.rds")
tweets_jhb <- read_rds("Data/Final_Data/tweets_jhb.rds")
tweets_kim <- read_rds("Data/Final_Data/tweets_kim.rds")
tweets_klerk <- read_rds("Data/Final_Data/tweets_klerk.rds")
tweets_mbomb <- read_rds("Data/Final_Data/tweets_mbomb.rds")
tweets_polo <- read_rds("Data/Final_Data/tweets_polo.rds")
tweets_pe <- read_rds("Data/Final_Data/tweets_pe.rds")

```



# Performing transformations

## cleaning data (text)
```{r}
#Separate date column
News24_tweets <- separate(News24_tweets, created_at, into=c("date","time"), sep=" ") %>% mutate(date = as.Date(date)) %>% select(date, time, text, source, favorite_count, retweet_count)
TimesLIVE_tweets <- separate(TimesLIVE_tweets, created_at, into=c("date","time"), sep=" ") %>% mutate(date = as.Date(date)) %>% select(date, time, text, source, favorite_count, retweet_count)
ewnupdates_tweets <- separate(ewnupdates_tweets, created_at, into=c("date","time"), sep=" ") %>% mutate(date = as.Date(date)) %>% select(date, time, text, source, favorite_count, retweet_count)
IOL_tweets <- separate(IOL_tweets, created_at, into=c("date","time"), sep=" ") %>% mutate(date = as.Date(date)) %>% select(date, time, text, source, favorite_count, retweet_count)
eNCA_tweets <- separate(eNCA_tweets, created_at, into=c("date","time"), sep=" ") %>% mutate(date = as.Date(date)) %>% select(date, time, text, source, favorite_count, retweet_count)
SABCNews_tweets <- separate(SABCNews_tweets, created_at, into=c("date","time"), sep=" ") %>% mutate(date = as.Date(date)) %>% select(date, time, text, source, favorite_count, retweet_count)


#Subset data into 3 week range 1 June - 21 June

myfuncNews24 <- function(x,y){News24_tweets[News24_tweets$date >= x & News24_tweets$date <= y,]}
myfunctimesLIVE <- function(x,y){TimesLIVE_tweets[TimesLIVE_tweets$date >= x & TimesLIVE_tweets$date <= y,]}
myfuncEwnupdate <- function(x,y){ewnupdates_tweets[ewnupdates_tweets$date >= x & ewnupdates_tweets$date <= y,]}
myfuncIOL <- function(x,y){IOL_tweets[IOL_tweets$date >= x & IOL_tweets$date <= y,]}
myfunceNCA <- function(x,y){eNCA_tweets[eNCA_tweets$date >= x & eNCA_tweets$date <= y,]}
myfuncSABC <- function(x,y){SABCNews_tweets[SABCNews_tweets$date >= x & SABCNews_tweets$date <= y,]}

DATE1 <- as.Date("2020-06-01")
DATE2 <- as.Date("2020-06-21")

News24_tweets <- myfuncNews24(DATE1,DATE2)
TimesLIVE_tweets <- myfunctimesLIVE(DATE1,DATE2)
ewnupdates_tweets <- myfuncEwnupdate(DATE1,DATE2)
IOL_tweets <- myfuncIOL(DATE1,DATE2)
eNCA_tweets <- myfunceNCA(DATE1,DATE2)
SABCNews_tweets <- myfuncSABC(DATE1,DATE2)


```

```{r}

data_cleaning <- function(x){
  
x <- x %>% select(text)
x <- unique(x)
x$text <- iconv(x$text,"UTF-8", "ASCII", sub="")#to remove emoji's 
x$stripped_text <- tolower(x$text)
x$stripped_text <- gsub("http[^[:space:]]*", " ", x$stripped_text) # remove links
x$stripped_text <- gsub("@\\S*","", x$stripped_text) # remove mentions
x$stripped_text <- gsub("amp","", x$stripped_text) 
x$stripped_text <- gsub("[\r\n]","", x$stripped_text)
x$stripped_text <- gsub("[[:punct:]]"," ", x$stripped_text) #remove punctuation
x$stripped_text = gsub("[ |\t]{2,}", " ", x$stripped_text) # remove tabs
x$stripped_text = gsub("^ ", "", x$stripped_text) # leading blanks
x$stripped_text = gsub(" $", "", x$stripped_text) #lagging blanks
x$stripped_text = gsub(" +", " ", x$stripped_text) #general spaces
x <- x %>% select(stripped_text)
    
}
 
```


# AddItional cleaning per dataframe
```{r}
#News Agency cleaning
tweets.News24_clean <- data_cleaning(News24_tweets)
tweets.TimesLIVE_clean <- data_cleaning(TimesLIVE_tweets)
tweets.eNCA_clean <- data_cleaning(eNCA_tweets)
tweets.IOL_clean <- data_cleaning(IOL_tweets)
tweets.ewn_clean <- data_cleaning(ewnupdates_tweets)
tweets.SABCNews_clean <- data_cleaning(SABCNews_tweets)


#Filter to selected Coronavirus related topics
tweets.News24_sub_clean <- tweets.News24_clean[grep("covid|corona|covid 19|covid19|coronavirus|sars cov 2|sars cov",tweets.News24_clean$stripped_text),]
tweets.TimesLIVE_sub_clean <- tweets.TimesLIVE_clean[grep("covid|corona|covid 19|covid19|coronavirus|sars cov 2|sars cov",tweets.TimesLIVE_clean$stripped_text),]
tweets.eNCA_sub_clean <- tweets.eNCA_clean[grep("covid|corona|covid 19|covid19|coronavirus|sars cov 2|sars cov",tweets.eNCA_clean$stripped_text),]
tweets.IOL_sub_clean <- tweets.IOL_clean[grep("covid|corona|covid 19|covid19|coronavirus|sars cov 2|sars cov",tweets.IOL_clean$stripped_text),]
tweets.ewn_sub_clean <- tweets.ewn_clean[grep("covid|corona|covid 19|covid19|coronavirus|sars cov 2|sars cov",tweets.ewn_clean$stripped_text),]
tweets.SABCNews_sub_clean <- tweets.SABCNews_clean[grep("covid|corona|covid 19|covid19|coronavirus|sars cov 2|sars cov",tweets.SABCNews_clean$stripped_text),]


#Preparation for Sentiment Analysis - Tokenize & Stem
tweets.News24_stem <- tweets.News24_sub_clean %>% unnest_tokens(word, stripped_text)
clean_tweets.News24 <- tweets.News24_stem %>% anti_join(stop_words)

tweets.TimesLIVE_stem <- tweets.TimesLIVE_sub_clean  %>% unnest_tokens(word, stripped_text)
clean_tweets.TimesLIVE <- tweets.TimesLIVE_stem %>% anti_join(stop_words)

tweets.eNCA_stem <- tweets.eNCA_sub_clean %>% unnest_tokens(word, stripped_text)
clean_tweets.eNCA <- tweets.eNCA_stem %>% anti_join(stop_words)

tweets.IOL_stem <- tweets.IOL_sub_clean %>% unnest_tokens(word, stripped_text)
clean_tweets.IOL <- tweets.IOL_stem %>% anti_join(stop_words)

tweets.ewn_stem <- tweets.ewn_sub_clean  %>% unnest_tokens(word, stripped_text)
clean_tweets.ewn <- tweets.ewn_stem %>% anti_join(stop_words)

tweets.SABCNews_stem <- tweets.SABCNews_sub_clean %>% unnest_tokens(word, stripped_text)
clean_tweets.SABCNews <- tweets.SABCNews_stem  %>% anti_join(stop_words)

```

```{r}
#Global Data
global_cleaned <- rbind(tweets.SABCNews_clean,tweets.ewn_clean,tweets.IOL_clean,tweets.eNCA_clean,tweets.TimesLIVE_clean,tweets.News24_clean)

global_tweets = rbind(SABCNews_tweets,eNCA_tweets,IOL_tweets,ewnupdates_tweets,TimesLIVE_tweets,News24_tweets)

Clean_tweets.global <- global_cleaned %>% unnest_tokens(word, stripped_text)
Clean_tweets.global <- Clean_tweets.global  %>% anti_join(stop_words)
```

```{r}
# Sentiment Analysis

# Global
afinn_global <- Clean_tweets.global %>% inner_join(get_sentiments("afinn")) %>% count(word, value, sort = TRUE) %>% ungroup()

global_score <- afinn_global %>% group_by(value) %>% summarise(count = sum(n))

# News24
afinn_news24 <- clean_tweets.News24 %>% inner_join(get_sentiments("afinn")) %>% count(word, value, sort = TRUE) %>% ungroup()

news24_score <- afinn_news24 %>% group_by(value) %>% summarise(count = sum(n))

# TimesLIVE
afinn_TimesLIVE <- clean_tweets.TimesLIVE %>% inner_join(get_sentiments("afinn")) %>% count(word, value, sort = TRUE) %>% ungroup()

TimesLIVE_score <- afinn_TimesLIVE %>% group_by(value) %>% summarise(count = sum(n))

# eNCA
afinn_eNCA <- clean_tweets.eNCA %>% inner_join(get_sentiments("afinn")) %>% count(word, value, sort = TRUE) %>% ungroup()

eNCA_score <- afinn_eNCA %>% group_by(value) %>% summarise(count = sum(n))

# IOL
afinn_IOL <- clean_tweets.IOL %>% inner_join(get_sentiments("afinn")) %>% count(word, value, sort = TRUE) %>% ungroup()

IOL_score <- afinn_IOL %>% group_by(value) %>% summarise(count = sum(n))

# ewnupdate
afinn_ewn <- clean_tweets.ewn %>% inner_join(get_sentiments("afinn")) %>% count(word, value, sort = TRUE) %>% ungroup()

ewn_score <- afinn_ewn %>% group_by(value) %>% summarise(count = sum(n))

# SABCNEWS
afinn_SABCNews <- clean_tweets.SABCNews %>% inner_join(get_sentiments("afinn")) %>% count(word, value, sort = TRUE) %>% ungroup()

SABC_score <- afinn_SABCNews %>% group_by(value) %>% summarise(count = sum(n))

```

# Topic Analysis
## Individual Topic Analysis
### LDA Topic Analysis
```{r}
# topic modeling using LDA
# example on rpubs.com

corpusNews24 <- Corpus(VectorSource(tweets.News24_clean))
corpusNews24 <- tm_map(corpusNews24, removeWords, stopwords("english"))  
corpusNews24 <- tm_map(corpusNews24, removeNumbers)
corpusNews24 <- tm_map(corpusNews24, stemDocument)
#Remove search terms -->
dtmNews24 = DocumentTermMatrix(corpusNews24)

corpusTimesLIVE <- Corpus(VectorSource(tweets.TimesLIVE_clean))
corpusTimesLIVE <- tm_map(corpusTimesLIVE, removeWords, stopwords("english"))  
corpusTimesLIVE <- tm_map(corpusTimesLIVE, removeNumbers)
corpusTimesLIVE <- tm_map(corpusTimesLIVE, stemDocument)
dtmTimesLIVE = DocumentTermMatrix(corpusTimesLIVE)

corpuseNCA <- Corpus(VectorSource(tweets.eNCA_clean))
corpuseNCA <- tm_map(corpuseNCA, removeWords, stopwords("english"))  
corpuseNCA <- tm_map(corpuseNCA, removeNumbers)
corpuseNCA <- tm_map(corpuseNCA, stemDocument)
dtmeNCA = DocumentTermMatrix(corpuseNCA)

corpusIOL <- Corpus(VectorSource(tweets.IOL_clean))
corpusIOL <- tm_map(corpusIOL, removeWords, stopwords("english"))  
corpusIOL <- tm_map(corpusIOL, removeNumbers)
corpusIOL <- tm_map(corpusIOL, stemDocument)
dtmIOL = DocumentTermMatrix(corpusIOL)

corpusewn <- Corpus(VectorSource(tweets.ewn_clean))
corpusewn <- tm_map(corpusewn, removeWords, stopwords("english"))  
corpusewn <- tm_map(corpusewn, removeNumbers)
corpusewn <- tm_map(corpusewn, stemDocument)
dtmewn = DocumentTermMatrix(corpusewn)

corpusSABCNews <- Corpus(VectorSource(tweets.SABCNews_clean))
corpusSABCNews <- tm_map(corpusSABCNews, removeWords, stopwords("english"))  
corpusSABCNews <- tm_map(corpusSABCNews, removeNumbers)
corpusSABCNews <- tm_map(corpusSABCNews, stemDocument)
dtmSABCNews = DocumentTermMatrix(corpusSABCNews)

corpusGlobal <- Corpus(VectorSource(global_cleaned))
corpusGlobal <- tm_map(corpusGlobal, removeWords, stopwords("english"))  
corpusGlobal <- tm_map(corpusGlobal, removeNumbers)
corpusGlobal <- tm_map(corpusGlobal, stemDocument)
dtmGlobal = DocumentTermMatrix(corpusGlobal)

```


```{r}
#LDA model with 16 topics selected
News24_lda = LDA(dtmNews24, k = 16, method = 'Gibbs', control = list(nstart = 5, seed = list(1505,99,36,56,88), best = TRUE,thin = 500, burnin = 4000, iter = 2000))

#LDA model with 16 topics selected
TimesLIVE_lda = LDA(dtmTimesLIVE, k = 16, method = 'Gibbs', control = list(nstart = 5, seed = list(1505,99,36,56,88), best = TRUE,thin = 500, burnin = 4000, iter = 2000))

#LDA model with 16 topics selected
eNCA_lda = LDA(dtmeNCA, k = 16, method = 'Gibbs', control = list(nstart = 5, seed = list(1505,99,36,56,88), best = TRUE,thin = 500, burnin = 4000, iter = 2000))

#LDA model with 16 topics selected
IOL_lda = LDA(dtmIOL, k = 16, method = 'Gibbs', control = list(nstart = 5, seed = list(1505,99,36,56,88), best = TRUE,thin = 500, burnin = 4000, iter = 2000))

#LDA model with 16 topics selected
ewn_lda = LDA(dtmewn, k = 16, method = 'Gibbs', control = list(nstart = 5, seed = list(1505,99,36,56,88), best = TRUE,thin = 500, burnin = 4000, iter = 2000))

#LDA model with 16 topics selected
SABCNews_lda = LDA(dtmSABCNews, k = 16, method = 'Gibbs', control = list(nstart = 5, seed = list(1505,99,36,56,88), best = TRUE,thin = 500, burnin = 4000, iter = 2000))

#LDA model with 16 topics selected
Global_lda = LDA(dtmGlobal, k = 16, method = 'Gibbs', control = list(nstart = 5, seed = list(1505,99,36,56,88), best = TRUE,thin = 500, burnin = 4000, iter = 2000))
```


```{r}
News24_topics_LDA <- tidy(News24_lda, matrix = "beta")
TimesLIVE_topics_LDA <- tidy(TimesLIVE_lda, matrix = "beta")
eNCA_topics_LDA <- tidy(eNCA_lda, matrix = "beta")
IOL_topics_LDA <- tidy(IOL_lda, matrix = "beta")
ewn_topics_LDA <- tidy(ewn_lda, matrix = "beta")
SABCNews_topics_LDA <- tidy(SABCNews_lda, matrix = "beta")
Global_topics_LDA <- tidy(Global_lda, matrix = "beta")

News24_top_terms_LDA <- 
  News24_topics_LDA %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

d <- by(News24_top_terms_LDA, News24_top_terms_LDA["topic"], head, n=5)
News24_top_terms_LDA <- rbind(d[[1]],d[[2]],d[[3]],d[[4]],d[[5]],d[[6]],d[[7]],d[[8]],d[[9]],d[[10]],d[[11]],d[[12]],d[[13]],d[[14]],d[[15]],d[[16]])
  

TimesLIVE_top_terms_LDA <- 
  TimesLIVE_topics_LDA %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

d <- by(TimesLIVE_top_terms_LDA, TimesLIVE_top_terms_LDA["topic"], head, n=5)
TimesLIVE_top_terms_LDA <- rbind(d[[1]],d[[2]],d[[3]],d[[4]],d[[5]],d[[6]],d[[7]],d[[8]],d[[9]],d[[10]],d[[11]],d[[12]],d[[13]],d[[14]],d[[15]],d[[16]])

eNCA_top_terms_LDA <- 
  eNCA_topics_LDA %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

d <- by(eNCA_top_terms_LDA, eNCA_top_terms_LDA["topic"], head, n=5)
eNCA_top_terms_LDA <- rbind(d[[1]],d[[2]],d[[3]],d[[4]],d[[5]],d[[6]],d[[7]],d[[8]],d[[9]],d[[10]],d[[11]],d[[12]],d[[13]],d[[14]],d[[15]],d[[16]])

IOL_top_terms_LDA <- 
  IOL_topics_LDA %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

d <- by(IOL_top_terms_LDA, IOL_top_terms_LDA["topic"], head, n=5)
IOL_top_terms_LDA <- rbind(d[[1]],d[[2]],d[[3]],d[[4]],d[[5]],d[[6]],d[[7]],d[[8]],d[[9]],d[[10]],d[[11]],d[[12]],d[[13]],d[[14]],d[[15]],d[[16]])

ewn_top_terms_LDA <- 
  ewn_topics_LDA %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

d <- by(ewn_top_terms_LDA, ewn_top_terms_LDA["topic"], head, n=5)
ewn_top_terms_LDA <- rbind(d[[1]],d[[2]],d[[3]],d[[4]],d[[5]],d[[6]],d[[7]],d[[8]],d[[9]],d[[10]],d[[11]],d[[12]],d[[13]],d[[14]],d[[15]],d[[16]])

SABCNews_top_terms_LDA <- 
  SABCNews_topics_LDA %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

d <- by(SABCNews_top_terms_LDA, SABCNews_top_terms_LDA["topic"], head, n=5)
SABCNews_top_terms_LDA <- rbind(d[[1]],d[[2]],d[[3]],d[[4]],d[[5]],d[[6]],d[[7]],d[[8]],d[[9]],d[[10]],d[[11]],d[[12]],d[[13]],d[[14]],d[[15]],d[[16]])

Global_top_terms_LDA <- 
  Global_topics_LDA %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

d <- by(Global_top_terms_LDA, Global_top_terms_LDA["topic"], head, n=5)
Global_top_terms_LDA <- rbind(d[[1]],d[[2]],d[[3]],d[[4]],d[[5]],d[[6]],d[[7]],d[[8]],d[[9]],d[[10]],d[[11]],d[[12]],d[[13]],d[[14]],d[[15]],d[[16]])

```

#Additional Statistics:
```{r}

#Topics found out by our model:
lda.topics_News24 = as.matrix(topics(News24_lda))
lda.topics_TimesLIVE = as.matrix(topics(TimesLIVE_lda))
lda.topics_eNCA = as.matrix(topics(eNCA_lda))
lda.topics_IOL = as.matrix(topics(IOL_lda))
lda.topics_ewn = as.matrix(topics(ewn_lda))
lda.topics_SABCNews = as.matrix(topics(SABCNews_lda))
lda.topics_Global = as.matrix(topics(Global_lda))

#summary(as.factor(lda.topics_News24[,1]))
#summary(as.factor(lda.topics_TimesLIVE[,1]))
#summary(as.factor(lda.topics_eNCA[,1]))
#summary(as.factor(lda.topics_IOL[,1]))
#summary(as.factor(lda.topics_ewn[,1]))
#summary(as.factor(lda.topics_SABCNews[,1]))
#summary(as.factor(lda.topics_Global[,1]))

#document wise probability of each topic.
topicprob_News24 = as.matrix(News24_lda@gamma)
topicprob_TimesLIVE = as.matrix(TimesLIVE_lda@gamma)
topicprob_eNCA = as.matrix(eNCA_lda@gamma)
topicprob_IOL = as.matrix(IOL_lda@gamma)
topicprob_ewn = as.matrix(ewn_lda@gamma)
topicprob_SABCNews = as.matrix(SABCNews_lda@gamma)
topicprob_Global = as.matrix(Global_lda@gamma)


#head(topicprob_News24,1)
#head(topicprob_TimesLIVE,1)
#head(topicprob_eNCA,1)
#head(topicprob_IOL,1)
#head(topicprob_ewn,1)
#head(topicprob_SABCNews,1)
#head(topicprob_Global,1)
```


### STM Topic Modelling
```{r}
processed_News24 <- textProcessor(tweets.News24_clean$stripped_text, metadata = News24_tweets)
processed_TimesLIVE <- textProcessor(tweets.TimesLIVE_clean$stripped_text, metadata = TimesLIVE_tweets)
processed_ewn <- textProcessor(tweets.ewn_clean$stripped_text, metadata = ewnupdates_tweets)
processed_IOL <- textProcessor(tweets.IOL_clean$stripped_text, metadata = IOL_tweets)
processed_eNCA <- textProcessor(tweets.eNCA_clean$stripped_text, metadata = eNCA_tweets)
processed_SABC <- textProcessor(tweets.SABCNews_clean$stripped_text, metadata = SABCNews_tweets)
processed_global <- textProcessor(tweets.SABCNews_clean$stripped_text, metadata = global_tweets)

```

```{r}
out_News24 <- prepDocuments(processed_News24$documents, processed_News24$vocab, processed_News24$meta)
out_TimesLIVE <- prepDocuments(processed_TimesLIVE$documents, processed_TimesLIVE$vocab, processed_TimesLIVE$meta)
out_ewn <- prepDocuments(processed_ewn$documents, processed_ewn$vocab, processed_ewn$meta)
out_IOL <- prepDocuments(processed_IOL$documents, processed_IOL$vocab, processed_IOL$meta)
out_eNCA <- prepDocuments(processed_eNCA$documents, processed_eNCA$vocab, processed_eNCA$meta)
out_SABC <- prepDocuments(processed_SABC$documents, processed_SABC$vocab, processed_SABC$meta)
out_global <- prepDocuments(processed_global$documents, processed_global$vocab, processed_global$meta)
```

```{r}
#News24
News24_docs <- out_News24$documents
News24_vocab <- out_News24$vocab
News24_meta <-out_News24$meta

#TimesLIVE
TimesLIVE_docs <- out_TimesLIVE$documents
TimesLIVE_vocab <- out_TimesLIVE$vocab
TimesLIVE_meta <-out_TimesLIVE$meta

#EWN
ewn_docs <- out_ewn$documents
ewn_vocab <- out_ewn$vocab
ewn_meta <-out_ewn$meta

#IOL
IOL_docs <- out_IOL$documents
IOL_vocab <- out_IOL$vocab
IOL_meta <-out_IOL$meta

#eNCA
eNCA_docs <- out_eNCA$documents
eNCA_vocab <- out_eNCA$vocab
eNCA_meta <-out_eNCA$meta

#SABC
SABC_docs <- out_SABC$documents
SABC_vocab <- out_SABC$vocab
SABC_meta <-out_SABC$meta

#Global
global_docs <- out_global$documents
global_vocab <- out_global$vocab
global_meta <-out_global$meta
```


```{r}
global_findingk <- searchK(documents = global_docs, vocab = global_vocab, K = c(5:50),
 prevalence =~ date, data = global_meta, verbose=FALSE)
```

```{r}
global_findingk <- read_rds("Data/Final_Data/global_findingk.rds")
write_rds(global_findingk, "Data/Final_Data/global_findingk.rds")
```

```{r}
#load("./findingk.Rda")

plot(global_findingk)
```


```{r}
#Running STM per news agency

News24_STM <- stm(documents = News24_docs, vocab = News24_vocab,
              K = 16, max.em.its = 75, data = News24_meta,
              init.type = "Spectral", verbose = FALSE)

timesLIVE_STM <- stm(documents = TimesLIVE_docs, vocab = TimesLIVE_vocab,
              K = 16, max.em.its = 75, data = TimesLIVE_meta,
              init.type = "Spectral", verbose = FALSE)

Ewnupdate_STM <- stm(documents = ewn_docs, vocab = ewn_vocab,
              K = 16, max.em.its = 75, data = ewn_meta,
              init.type = "Spectral", verbose = FALSE)

IOL_STM <- stm(documents = IOL_docs, vocab = IOL_vocab,
              K = 16, max.em.its = 75, data = IOL_meta,
              init.type = "Spectral", verbose = FALSE)

eNCA_STM <- stm(documents = eNCA_docs, vocab = eNCA_vocab,
              K = 16, max.em.its = 75, data = eNCA_meta,
              init.type = "Spectral", verbose = FALSE)

SABC_STM <- stm(documents = SABC_docs, vocab = SABC_vocab,
              K = 16, max.em.its = 75, data = SABC_meta,
              init.type = "Spectral", verbose = FALSE)

global_STM <- stm(documents = global_docs, vocab = global_vocab,
              K = 16, max.em.its = 75, data = global_meta,
              init.type = "Spectral", verbose = FALSE)

```


```{r}
News24_topics <- tidy(News24_STM, matrix = "beta")
timesLIVE_topics <- tidy(timesLIVE_STM, matrix = "beta")
Ewnupdate_topics <- tidy(Ewnupdate_STM, matrix = "beta")
IOL_topics <- tidy(IOL_STM, matrix = "beta")
eNCA_topics <- tidy(eNCA_STM, matrix = "beta")
SABC_topics <- tidy(SABC_STM, matrix = "beta")
global_topics <- tidy(global_STM, matrix = "beta")

News24_top_terms <- 
  News24_topics %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

timesLIVE_top_terms <- 
  timesLIVE_topics %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

Ewnupdate_top_terms <- 
  Ewnupdate_topics %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

IOL_top_terms <- 
  IOL_topics %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

eNCA_top_terms <- 
  eNCA_topics %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

SABC_top_terms <- 
  SABC_topics %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

global_top_terms <- 
  global_topics %>%
  group_by(topic) %>%
  top_n(5, beta) %>%
  ungroup() %>%
  arrange(topic, -beta)

```


# Additional Analysis
```{r}
# Frequency of Tweets
News24_freq <- News24_tweets %>% group_by(date) %>% summarise(News24 = n())
timesLIVE_freq <- TimesLIVE_tweets %>% group_by(date) %>% summarise(timesLIVE = n()) %>% select(timesLIVE)
Ewnupdate_freq <- ewnupdates_tweets %>% group_by(date) %>% summarise(Ewnupdate = n()) %>% select(Ewnupdate)
IOL_freq <- IOL_tweets %>% group_by(date) %>% summarise(IOL = n()) %>% select(IOL)
eNCA_freq <- eNCA_tweets %>% group_by(date) %>% summarise(eNCA = n()) %>% select(eNCA)
SABC_freq <- SABCNews_tweets %>% group_by(date) %>% summarise(SABC = n()) %>% select(SABC)

# sum days and join together
Frequency_tweets <- bind_cols(News24_freq,timesLIVE_freq,Ewnupdate_freq,IOL_freq,eNCA_freq,SABC_freq)

#retweet count 
News24_retweet <- News24_tweets %>% group_by(date) %>% summarise(News24 = sum(retweet_count)) 
timesLIVE_retweet <- TimesLIVE_tweets %>% group_by(date) %>% summarise(timesLIVE = sum(retweet_count)) %>% select(timesLIVE)
Ewnupdate_retweet <- ewnupdates_tweets %>% group_by(date) %>% summarise(Ewnupdate = sum(retweet_count)) %>% select(Ewnupdate)
IOL_retweet <- IOL_tweets %>% group_by(date) %>% summarise(IOL = sum(retweet_count)) %>% select(IOL)
eNCA_retweet <- eNCA_tweets %>% group_by(date) %>% summarise(eNCA = sum(retweet_count)) %>% select(eNCA)
SABC_retweet <- SABCNews_tweets %>% group_by(date) %>% summarise(SABC = sum(retweet_count)) %>% select(SABC)

# sum days and join together
retweet_tweets <- bind_cols(News24_retweet,timesLIVE_retweet,Ewnupdate_retweet,IOL_retweet,eNCA_retweet,SABC_retweet)

# like count
News24_likes <- News24_tweets %>% group_by(date) %>% summarise(News24 = sum(favorite_count)) 
timesLIVE_likes <- TimesLIVE_tweets %>% group_by(date) %>% summarise(timesLIVE = sum(favorite_count)) %>% select(timesLIVE) 
Ewnupdate_likes <- ewnupdates_tweets %>% group_by(date) %>% summarise(Ewnupdate = sum(favorite_count)) %>% select(Ewnupdate)
IOL_likes <- IOL_tweets %>% group_by(date) %>% summarise(IOL = sum(favorite_count)) %>% select(IOL)
eNCA_likes <- eNCA_tweets %>% group_by(date) %>% summarise(eNCA = sum(favorite_count)) %>% select(eNCA)
SABC_likes <- SABCNews_tweets %>% group_by(date) %>% summarise(SABC = sum(favorite_count)) %>% select(SABC)

# sum days and join together
Likes_tweets <- bind_cols(News24_likes,timesLIVE_likes,Ewnupdate_likes,IOL_likes,eNCA_likes,SABC_likes)

#count the total number of tweets vs covid tweets
News24_Genposts <- nrow(News24_tweets)
timesLIVE_Genposts <- nrow(TimesLIVE_tweets)
Ewnupdate_Genposts <- nrow(ewnupdates_tweets)
IOL_Genposts <- nrow(IOL_tweets)
eNCA_Genposts<- nrow(eNCA_tweets)
SABC_Genposts <- nrow(SABCNews_tweets)

News24_CVDposts <- nrow(tweets.News24_sub_clean)
timesLIVE_CVDposts <- nrow(tweets.TimesLIVE_sub_clean)
Ewnupdate_CVDposts <- nrow(tweets.ewn_sub_clean)
IOL_CVDposts <- nrow(tweets.IOL_sub_clean)
eNCA_CVDposts<- nrow(tweets.eNCA_sub_clean)
SABC_CVDposts <- nrow(tweets.SABCNews_sub_clean)

Gen_tweets <- News24_Genposts + timesLIVE_Genposts + Ewnupdate_Genposts + IOL_Genposts +eNCA_Genposts + SABC_Genposts 

CVD_tweets <- News24_CVDposts + timesLIVE_CVDposts + Ewnupdate_CVDposts + IOL_CVDposts + eNCA_CVDposts + SABC_CVDposts

Other_tweets <- Gen_tweets - CVD_tweets

tweet_type <- c("General","Covid-related")
tweet_count <- c(Other_tweets,CVD_tweets)

Type_data <- data.frame(tweet_type,tweet_count)

# General tweets RSA vs those belonging to selected news agencies
Media_tweets <- tweets_za %>% filter(screen_name == "TimesLIVE" | screen_name == "IOL" | screen_name == "eNCA" | screen_name == "ewnupdates" | screen_name == "SABCNews" | screen_name == "News24") %>% nrow()

RSA_other_tweets <- nrow(tweets_za) - Media_tweets

RSA_tweeter <- c("Selected Media","Other")
RSA_tweet_value <- c(Media_tweets,RSA_other_tweets)

RSA_data <- data.frame(RSA_tweeter,RSA_tweet_value)

# followers for selected media
News24_followers <- tweets_za %>% filter(screen_name == "News24") %>% head(1) %>% select(followers_count)
TimesLIVE_followers <- tweets_za %>% filter(screen_name == "TimesLIVE") %>% head(1) %>% select(followers_count)
ewn_followers <- tweets_za %>% filter(screen_name == "ewnupdates") %>% head(1) %>% select(followers_count)
IOL_followers <- tweets_za %>% filter(screen_name == "IOL") %>% head(1) %>% select(followers_count)
eNCA_followers <- tweets_za %>% filter(screen_name == "eNCA") %>% head(1) %>% select(followers_count)
SABC_followers <- tweets_za %>% filter(screen_name == "SABCNews") %>% head(1) %>% select(followers_count)

Media <- c("News24","TimesLIVE","ewnupdates","IOL","eNCA","SABCNews")
Followers_media <- data.frame(Media,rbind(News24_followers,TimesLIVE_followers,ewn_followers,IOL_followers,eNCA_followers,SABC_followers)) 

```


```{r}
bloem_nr <- nrow(tweets_bloem)
cpt_nr <- nrow(tweets_cpt)
durb_nr <- nrow(tweets_durb)
jhb_nr <- nrow(tweets_jhb)
kim_nr <- nrow(tweets_kim)
klerk_nr <- nrow(tweets_klerk)
mbomb_nr <- nrow(tweets_mbomb)
pe_nr <- nrow(tweets_pe)
polo_nr <- nrow(tweets_polo)


city_tweets <- rbind(bloem_nr,cpt_nr,durb_nr,kim_nr,jhb_nr,klerk_nr,mbomb_nr,pe_nr,polo_nr)
cityNames <- rbind("Bloem","CPT", "Durban", "Kimberley" ,"JHB", "Klerks", "Mbombela", "Polokwane", "P.E")

cityCombined <- data.frame(cityNames,city_tweets)
cityCombined <- cityCombined %>% add_column(Percentage = (city_tweets/(sum(city_tweets))) * 100)
cityCombined

ggplot(cityCombined, aes(x=cityNames, y=city_tweets, fill = cityNames)) + geom_bar(stat = "identity", width = 1) + geom_text(aes(label = paste0(round(Percentage,digits = 1), "%")), position = position_stack(vjust=0.5)) + labs(x = NULL, y = NULL, fill = NULL, title = "Distribution of Covid related tweets across major cities", caption = "\nSource: Data collected from Twitter's REST API via rtweet")
#scale_y_continuous(breaks = c(0.00, 0.005, 0.010, 0.015, 0.02),labels = c("0", ".05", ".01", ".015", ".02"))
```

```{r}

geocoded <- lat_lng(tweets_za)
par(mar = c(1, 1, 1, 1))
drawThis <- map("world","South Africa", col="blue", fill=TRUE)
with(geocoded, points(lng, lat, pch = 20, cex = .75, col = "red"))

```


## Done

# Exporting transformation results

```{r}
# Sentiment Analysis
write_rds(afinn_global, "Data/Final_Data/afinn_global.rds")
write_rds(global_score, "Data/Final_Data/global_score.rds")
write_rds(afinn_news24, "Data/Final_Data/afinn_news24.rds")
write_rds(news24_score, "Data/Final_Data/news24_score.rds")
write_rds(afinn_TimesLIVE, "Data/Final_Data/afinn_TimesLIVE.rds")
write_rds(TimesLIVE_score, "Data/Final_Data/TimesLIVE_score.rds")
write_rds(afinn_eNCA, "Data/Final_Data/afinn_eNCA.rds")
write_rds(eNCA_score, "Data/Final_Data/eNCA_score.rds")
write_rds(afinn_IOL, "Data/Final_Data/afinn_IOL.rds")
write_rds(IOL_score, "Data/Final_Data/IOL_score.rds")
write_rds(afinn_ewn, "Data/Final_Data/afinn_ewn.rds")
write_rds(ewn_score, "Data/Final_Data/ewn_score.rds")
write_rds(afinn_SABCNews, "Data/Final_Data/afinn_SABCNews.rds")
write_rds(SABC_score, "Data/Final_Data/SABC_score.rds")

#LDA
write_rds(News24_top_terms_LDA, "Data/Final_Data/News24_top_terms_LDA.rds")
write_rds(TimesLIVE_top_terms_LDA, "Data/Final_Data/timesLIVE_top_terms_LDA.rds")
write_rds(ewn_top_terms_LDA, "Data/Final_Data/Ewnupdate_top_terms_LDA.rds")
write_rds(IOL_top_terms_LDA, "Data/Final_Data/IOL_top_terms_LDA.rds")
write_rds(eNCA_top_terms_LDA, "Data/Final_Data/eNCA_top_terms_LDA.rds")
write_rds(SABCNews_top_terms_LDA, "Data/Final_Data/SABC_top_terms_LDA.rds")
write_rds(Global_top_terms_LDA, "Data/Final_Data/global_top_terms_LDA.rds")

#STM
write_rds(News24_top_terms, "Data/Final_Data/News24_top_terms.rds")
write_rds(timesLIVE_top_terms, "Data/Final_Data/timesLIVE_top_terms.rds")
write_rds(Ewnupdate_top_terms, "Data/Final_Data/Ewnupdate_top_terms.rds")
write_rds(IOL_top_terms, "Data/Final_Data/IOL_top_terms.rds")
write_rds(eNCA_top_terms, "Data/Final_Data/eNCA_top_terms.rds")
write_rds(SABC_top_terms, "Data/Final_Data/SABC_top_terms.rds")
write_rds(global_top_terms, "Data/Final_Data/global_top_terms.rds")

# Additional Analysis
write_rds(Frequency_tweets,"Data/Final_Data/Frequency_tweets.rds")
write_rds(retweet_tweets,"Data/Final_Data/retweet_tweets.rds")
write_rds(Likes_tweets,"Data/Final_Data/Like_tweets.rds")
write_rds(Type_data,"Data/Final_Data/Tweet_Type.rds")
write_rds(RSA_data,"Data/Final_Data/RSA_data.rds")
write_rds(Followers_media,"Data/Final_Data/Followers_media.rds")

```

