---
title: "Data Transformation"
output: html_notebook
---

```{r}
#install_github("mkearney/rtweet")

#Packages
library(usethis)
library(devtools)
library(dplyr)
library(rtweet)
library(readr)
library(topicmodels)
library(tidyverse)
library(maps)
```

## Load extracted data 
```{r}
News24_tweets <- read_rds("Data/Raw_Timeline_Data/News24_tweets.rds")
TimesLIVE_tweets <- read_rds("Data/Raw_Timeline_Data/TimesLIVE_tweets.rds")
eNCA_tweets <- read_rds("Data/Raw_Timeline_Data/eNCA_tweets.rds")
IOL_tweets <- read_rds("Data/Raw_Timeline_Data/IOL_tweets.rds")
SABCNews_tweets <- read_rds("Data/Raw_Timeline_Data/SABCNews_tweets.rds")
ewnupdates_tweets <- read_rds("Data/Raw_Timeline_Data/ewnupdates_tweets")
```

```{r}
tweets_za_13 <- read_rds("Data/Raw_Filtered_Data/tweets_za_13.rds")
tweets_za_14 <- read_rds("Data/Raw_Filtered_Data/tweets_za_14.rds")
tweets_za_15 <- read_rds("Data/Raw_Filtered_Data/tweets_za_15.rds")
tweets_za_16 <- read_rds("Data/Raw_Filtered_Data/tweets_za_16.rds")
tweets_za_17 <- read_rds("Data/Raw_Filtered_Data/tweets_za_17.rds")
tweets_za_18 <- read_rds("Data/Raw_Filtered_Data/tweets_za_18.rds")
#tweets_za_19 <- read_rds("Data/Raw_Filtered_Data/tweets_za_19.rds")
#tweets_za_20 <- read_rds("Data/Raw_Filtered_Data/tweets_za_20.rds")
#tweets_za_21 <- read_rds("Data/Raw_Filtered_Data/tweets_za_21.rds")
```

```{r}
tweets_bloem_13 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_13.rds")
tweets_bloem_14 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_14.rds")
tweets_bloem_15 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_15.rds")
tweets_bloem_16 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_16.rds")
tweets_bloem_17 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_17.rds")
tweets_bloem_18 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_18.rds")
#tweets_bloem_19 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_19.rds")
#tweets_bloem_20 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_20.rds")
#tweets_bloem_21 <- read_rds("Data/Raw_Filtered_Data/tweets_bloem_21.rds")
```

```{r}
tweets_cpt_13 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_13.rds")
tweets_cpt_14 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_14.rds")
tweets_cpt_15 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_15.rds")
tweets_cpt_16 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_16.rds")
tweets_cpt_17 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_17.rds")
tweets_cpt_18 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_18.rds")
#tweets_cpt_19 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_19.rds")
#tweets_cpt_20 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_20.rds")
#tweets_cpt_21 <- read_rds("Data/Raw_Filtered_Data/tweets_cpt_21.rds")
```

```{r}
tweets_durb_13 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_13.rds")
tweets_durb_14 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_14.rds")
tweets_durb_15 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_15.rds")
tweets_durb_16 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_16.rds")
tweets_durb_17 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_17.rds")
tweets_durb_18 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_18.rds")
#tweets_durb_19 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_19.rds")
#tweets_durb_20 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_20.rds")
#tweets_durb_21 <- read_rds("Data/Raw_Filtered_Data/tweets_durb_21.rds")
```

```{r}
tweets_jhb_13 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_13.rds")
tweets_jhb_14 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_14.rds")
tweets_jhb_15 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_15.rds")
tweets_jhb_16 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_16.rds")
tweets_jhb_17 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_17.rds")
tweets_jhb_18 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_18.rds")
#tweets_jhb_19 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_19.rds")
#tweets_jhb_20 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_20.rds")
#tweets_jhb_21 <- read_rds("Data/Raw_Filtered_Data/tweets_jhb_21.rds")
```

```{r}
tweets_kim_13 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_13.rds")
tweets_kim_14 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_14.rds")
tweets_kim_15 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_15.rds")
tweets_kim_16 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_16.rds")
tweets_kim_17 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_17.rds")
tweets_kim_18 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_18.rds")
#tweets_kim_19 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_19.rds")
#tweets_kim_20 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_20.rds")
#tweets_kim_21 <- read_rds("Data/Raw_Filtered_Data/tweets_kim_21.rds")
```

```{r}
tweets_klerk_13 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_13.rds")
tweets_klerk_14 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_14.rds")
tweets_klerk_15 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_15.rds")
tweets_klerk_16 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_16.rds")
tweets_klerk_17 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_17.rds")
tweets_klerk_18 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_18.rds")
#tweets_klerk_19 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_19.rds")
#tweets_klerk_20 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_20.rds")
#tweets_klerk_21 <- read_rds("Data/Raw_Filtered_Data/tweets_klerk_21.rds")
```

```{r}
tweets_mbomb_13 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_13.rds")
tweets_mbomb_14 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_14.rds")
tweets_mbomb_15 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_15.rds")
tweets_mbomb_16 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_16.rds")
tweets_mbomb_17 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_17.rds")
tweets_mbomb_18 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_18.rds")
#tweets_mbomb_19 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_19.rds")
#tweets_mbomb_20 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_20.rds")
#tweets_mbomb_21 <- read_rds("Data/Raw_Filtered_Data/tweets_mbomb_21.rds")
```

```{r}
tweets_polo_13 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_13.rds")
tweets_polo_14 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_14.rds")
tweets_polo_15 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_15.rds")
tweets_polo_16 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_16.rds")
tweets_polo_17 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_17.rds")
tweets_polo_18 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_18.rds")
#tweets_polo_19 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_19.rds")
#tweets_polo_20 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_20.rds")
#tweets_polo_21 <- read_rds("Data/Raw_Filtered_Data/tweets_polo_21.rds")
```

```{r}
tweets_pe_13 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_13.rds")
tweets_pe_14 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_14.rds")
tweets_pe_15 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_15.rds")
tweets_pe_16 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_16.rds")
tweets_pe_17 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_17.rds")
tweets_pe_18 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_18.rds")
#tweets_pe_19 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_19.rds")
#tweets_pe_20 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_20.rds")
#tweets_pe_21 <- read_rds("Data/Raw_Filtered_Data/tweets_pe_21.rds")
```

# Bind Dataframes
```{r}
tweets_za <-rbind(tweets_za_18,tweets_za_17,tweets_za_16,tweets_za_15,tweets_za_14,tweets_za_13)
tweets_bloem <-rbind(tweets_bloem_18,tweets_bloem_17,tweets_bloem_16,tweets_bloem_15,tweets_bloem_14,tweets_bloem_13)
tweets_cpt <-rbind(tweets_cpt_18,tweets_cpt_17,tweets_cpt_16,tweets_cpt_15,tweets_cpt_14,tweets_cpt_13)
tweets_durb <-rbind(tweets_durb_18,tweets_durb_17,tweets_durb_16,tweets_durb_15,tweets_durb_14,tweets_durb_13)
tweets_jhb <-rbind(tweets_jhb_18,tweets_jhb_17,tweets_jhb_16,tweets_jhb_15,tweets_jhb_14,tweets_jhb_13)
tweets_kim <-rbind(tweets_kim_18,tweets_kim_17,tweets_kim_16,tweets_kim_15,tweets_kim_14,tweets_kim_13)
tweets_klerk <-rbind(tweets_klerk_18,tweets_klerk_17,tweets_klerk_16,tweets_klerk_15,tweets_klerk_14,tweets_klerk_13)
tweets_mbomb <-rbind(tweets_mbomb_18,tweets_mbomb_17,tweets_mbomb_16,tweets_mbomb_15,tweets_mbomb_14,tweets_mbomb_13)
tweets_polo <-rbind(tweets_polo_18,tweets_polo_17,tweets_polo_16,tweets_polo_15,tweets_polo_14,tweets_polo_13)
tweets_pe <-rbind(tweets_pe_18,tweets_pe_17,tweets_pe_16,tweets_pe_15,tweets_pe_14,tweets_pe_13)

```


# Performing transformations
```{r}
# Sentiment Analysis


```

```{r}
# Topic Analysis

#start by cleaning text
#tweet <- gsub("https\\S*","")
#         gsub("@\\S*","")
#         gsub("amp","")
#         gsub("[\r\n]","")
#         gsub("[[:punct:]]","")

#removing common words such as to or and
#tweets <- tweets %>% select(text) %>% unnest_tokens(word, text)
#tweets <- tweets %>% anti_join(stop_words)

#find frequent words (top 15) in tweets
#tweets <- count(word, sort = TRUE) %>%  top_n(15) %>% mutate(word = reoder(wotd, n))

# topic modeling using LDA
# needs libary(topicmodels)
# example on rpubs.com



# comparing total tweets by medias vs the amount that was related to COVID-19 COULD THIS BE SEEN AS TOPIC ANALYSIS???????
#start
#end

```

```{r}
# Other Analysis

# Frequency of tweets by day
News24_freq <- separate(News24_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(News24 = n())

timesLIVE_freq <- separate(TimesLIVE_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(timesLIVE = n())

Ewnupdate_freq <- separate(News24_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(Ewnupdate = n())

IOL_freq <- separate(IOL_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(IOL = n())

eNCA_freq <- separate(ewnupdates_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(eNCA = n()) 

SABC_freq <- separate(SABCNews_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(SABC = n())

# sum days and join together, then send to visualisation
#Frequency_tweets <- cbind(News24_freq,timesLIVE_freq,Ewnupdate_freq,IOL_freq,eNCA_freq,SABC_freq)

#retweet count 
News24_retweet <- separate(News24_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(News24 = sum(retweet_count))

timesLIVE_retweet <- separate(TimesLIVE_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(timesLIVE = sum(retweet_count))

Ewnupdate_retweet <- separate(News24_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(Ewnupdate = sum(retweet_count))

IOL_retweet <- separate(IOL_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(IOL = sum(retweet_count))

eNCA_retweet <- separate(ewnupdates_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(eNCA = sum(retweet_count)) 

SABC_retweet <- separate(SABCNews_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(SABC = sum(retweet_count))

# sum days and join together, then send to visualisation
#retweet_tweets <- cbind(News24_retweet,timesLIVE_retweet,Ewnupdate_retweet,IOL_retweet,eNCA_retweet,SABC_retweet)

# like count
News24_likes <- separate(News24_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(News24 = sum(favorite_count))

timesLIVE_likes <- separate(TimesLIVE_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(timesLIVE = sum(favourite_count))

Ewnupdate_likes <- separate(News24_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(Ewnupdate = sum(favourite_count))

IOL_likes <- separate(IOL_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(IOL = sum(favourite_count))

eNCA_likes <- separate(ewnupdates_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(eNCA = sum(favourite_count)) 

SABC_likes <- separate(SABCNews_tweets, created_at, into=c("date","time"), sep=" ") %>% group_by(date) %>% summarise(SABC = sum(favourite_count))

# sum days and join together, then send to visualisation
#Likes_tweets <- cbind(News24_likes,timesLIVE_likes,Ewnupdate_likes,IOL_likes,eNCA_likes,SABC_likes)


# Comparing likes and retweets i.e maby retweets per like or compaing stats of non-covid to covid
#start
#end

```

```{r}
#count the total number of tweets for each media house
News24_freq <- nrow(News24_freq)
timesLIVE_freq <- nrow(timesLIVE_freq)
Ewnupdate_freq <- nrow(Ewnupdate_freq)
IOL_freq <- nrow(IOL_freq)
eNCA_freq <- nrow(eNCA_freq)
SABC_freq <- nrow(SABC_freq)

News24_freq
timesLIVE_freq
Ewnupdate_freq
IOL_freq
eNCA_freq
SABC_freq
```


## Done

# Exporting transformation results
```{r echo=TRUE}
#write_rds(News24_tweets, "Results/News24_tweets.rds")
#write_rds(TimesLIVE_tweets, "Results/TimesLIVE_tweets.rds")
#write_rds(eNCA_tweets, "Results/eNCA_tweets.rds")
#write_rds(IOL_tweets,"Results/IOL_tweets.rds")
#write_rds(SABCNews_tweets,"Results/SABCNews_tweets.rds")
#write_rds(ewnupdates_tweets,"Results/ewnupdates_tweets")
```

```{r}




```



```

## Exporting results
```{r}

```